---
- hosts: all
  become: true

  tasks:
    - name: "Ensure Python, pip, and dependencies"
      apt:
        name:
          - python3
          - python3-pip
          - python3-distutils
          - python3-setuptools
          - python3-apt
        state: present
        update_cache: yes

    - name: "Ensure packaging module (modern version parsing)"
      pip:
        name: packaging
        state: latest
        executable: pip3

    - name: "Verify distutils.version availability"
      command: python3 -c "from distutils.version import StrictVersion; print('StrictVersion OK')"
      register: version_check
      ignore_errors: true

    - name: "Show version check result"
      debug:
        msg: "{{ version_check.stdout | default('Version check failed') }}"
